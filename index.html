<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ù†ÙˆØ± Ù„Ù„Ù†Ø¸Ø§Ø±Ø§Øª</title>
    <style>
        /* ==========================================================================
           Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
           ========================================================================== */
        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }

        .main-container {
            width: 80mm;
            margin: 20px auto;
            background: #fff;
            padding: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            min-height: 100vh;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù„ÙˆØ¬Ùˆ */
        .logo-img {
            max-width: 150px;
            height: auto;
            margin-bottom: 5px;
        }

        /* Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© */
        .ticket {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            background: #fff;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù„Ø®Øµ */
        .summary-section {
            margin-top: 20px;
            border-top: 2px solid #333;
            padding-top: 10px;
        }
        
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }
        
        .summary-table th {
            background-color: #333;
            color: #fff;
            padding: 5px;
            text-align: center;
        }
        
        .summary-table td {
            border-bottom: 1px solid #ddd;
            padding: 5px;
            text-align: center;
        }

        .delete-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            padding: 2px 5px;
            font-size: 10px;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ø®ÙÙŠØ© */
        #hidden-print-area {
            display: none;
        }

        .saved-ticket {
            border-bottom: 2px dashed #000;
            padding: 15px 0;
            display: block;
        }

        h3, p { margin: 5px 0; color: #000; }
        
        .header {
            text-align: center;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .logo-text { font-size: 24px; font-weight: bold; display: block; }
        .sub-logo { font-size: 14px; }

        .info-section {
            font-size: 13px;
            margin-bottom: 10px;
            border-bottom: 1px dashed #000;
            padding-bottom: 5px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        select, input[type="number"], input[type="text"] {
            font-family: 'Tahoma', 'Arial', sans-serif;
            font-size: 12px;
            border: 1px solid #ccc;
            padding: 2px 5px;
            border-radius: 3px;
            background-color: #fff;
            font-weight: bold;
            color: #000;
        }
        
        .price-input { width: 80px; text-align: center; }
        .invoice-num-input { width: 100px; text-align: inherit; } 
        .employee-select { width: 140px; text-align: inherit; font-weight: bold; }

        table { width: 100%; border-collapse: collapse; margin: 10px 0; font-size: 12px; }
        th, td { border: 1px solid #000; padding: 5px; text-align: center; }
        th { background-color: #eee; font-weight: bold; }

        .details-section { font-size: 13px; margin-top: 10px; font-weight: bold; }
        body[dir="rtl"] .details-section { text-align: right; }
        body[dir="ltr"] .details-section { text-align: left; }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .total-row {
            border-top: 2px solid #000;
            padding-top: 5px;
            margin-top: 5px;
            font-weight: 900;
            font-size: 14px;
        }

        .footer {
            margin-top: 20px;
            text-align: center;
            font-size: 12px;
            padding-top: 10px;
            border-top: 1px dashed #000;
        }

        .signature-line { margin-top: 20px; display: flex; justify-content: space-between; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± ØªØ­Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© */
        .controls { 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
            margin-top: 20px; 
            background: #fdfdfd;
            padding: 10px;
            border: 1px solid #eee;
        }
        .btn {
            display: block; width: 100%; padding: 12px; color: white; text-align: center;
            border: none; cursor: pointer; font-size: 14px; border-radius: 4px;
            font-family: 'Tahoma', sans-serif; font-weight: bold;
        }
        .print-current-btn { background-color: #007bff; font-size: 16px; } 
        .print-daily-btn { background-color: #28a745; } 
        .clear-btn { background-color: #dc3545; font-size: 12px; padding: 8px; }
        .lang-btn { background-color: #6c757d; font-size: 12px; padding: 8px; }

        @media print {
            @page { size: 80mm auto; margin: 0; }
            body { background-color: #fff; margin: 0; }
            .main-container { width: 100%; margin: 0; box-shadow: none; border: none; }
            .controls, .delete-btn, .summary-section { display: none !important; } 
            select, input { border: none !important; background: transparent !important; appearance: none; -webkit-appearance: none; }
            body:not(.printing-report) #hidden-print-area { display: none !important; }
            body.printing-report #current-ticket-area { display: none !important; }
            body.printing-report #hidden-print-area { display: block !important; }
        }
    </style>
</head>
<body>

<div class="main-container">
    
    <div id="current-ticket-area" class="ticket">
        <div class="header">
            <img src="logo.png" alt="Noor Logo" class="logo-img" onerror="this.style.display='none'">
            <span class="logo-text">NOOR Opticals</span>
            <span class="sub-logo">Ù†Ù€Ù€Ù€ÙˆØ± Ù„Ù„Ù†Ø¸Ø§Ø±Ø§Øª</span>
            <h3 data-i18n="invoice_title">ÙØ§ØªÙˆØ±Ø© Ø·Ù„Ø¨ Ø¹Ø¯Ø³Ø§Øª</h3>
        </div>

        <div class="info-section">
            <div class="info-row">
                <label data-i18n="invoice_num">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</label>
                <input type="text" id="inv-num" class="invoice-num-input" placeholder="0001">
            </div>

            <div class="info-row">
                <label data-i18n="branch">Ø§Ù„ÙØ±Ø¹:</label>
                <select id="branch-select" onchange="updateEmployees()" style="width: auto;">
                    <option value="Noor 1">Noor 1</option>
                    <option value="Noor 2">Noor 2</option>
                    <option value="Noor 3">Noor 3</option>
                    <option value="Noor 4">Noor 4</option>
                </select>
            </div>
            <div class="info-row">
                <span><span data-i18n="date">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span> <span id="current-date"></span></span>
                <span><span data-i18n="time">Ø§Ù„ÙˆÙ‚Øª:</span> <span id="current-time">--:--:--</span></span>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th data-i18n="eye_header">Ø§Ù„Ø¹ÙŠÙ†</th>
                    <th>SPH</th>
                    <th>CYL</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td data-i18n="right_eye">R (ÙŠÙ…ÙŠÙ†)</td>
                    <td><select id="r-sph" class="diopter-select"></select></td>
                    <td><select id="r-cyl" class="diopter-select"></select></td>
                </tr>
                <tr>
                    <td data-i18n="left_eye">L (ÙŠØ³Ø§Ø±)</td>
                    <td><select id="l-sph" class="diopter-select"></select></td>
                    <td><select id="l-cyl" class="diopter-select"></select></td>
                </tr>
            </tbody>
        </table>

        <div class="details-section">
            <div class="detail-row">
                <strong data-i18n="lens_type">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø¯Ø³Ø©:</strong>
                <select id="lens-type" class="lens-select">
                    <option value="MC">MC (Ù…Ù„ØªÙŠ ÙƒÙˆØª)</option>
                    <option value="Bl cut">Bl cut (Ø¨Ù„Ùˆ ÙƒØª)</option>
                    <option value="Bl cut Blue">Bl cut Blue</option>
                    <option value="Bl cut Green">Bl cut Green</option>
                    <option value="PGX">PGX (ÙÙˆØªÙˆ Ù‚Ø±ÙŠ)</option>
                    <option value="PGX Brown">PGX Brown (ÙÙˆØªÙˆ Ø¨Ø±Ø§ÙˆÙ†)</option>
                    <option value="Progressive">Progressive (Ù‚Ø±ÙŠØ¨ Ø¨Ø¹ÙŠØ¯)</option>
                    <option value="Poly">Poly (Ø¶Ø¯ Ø§Ù„ÙƒØ³Ø±)</option>
                    <option value="CR39">CR39 (Ù†ÙˆØ±Ù…Ù„)</option>
                    <option value="Fitting Color">ØªØ±ÙƒÙŠØ¨ Ù…Ù„ÙˆÙ†</option>
                    <option value="Rimless Color">ØªØ±ÙƒÙŠØ¨ ØªÙ„ÙˆÙŠÙ† Ø¨Ø¯ÙˆÙ† Ø§Ø·Ø§Ø±</option>
                    <option value="Half Rim Color">ØªØ±ÙƒÙŠØ¨ ÙˆØªÙ„ÙˆÙŠÙ† Ù†Øµ Ø§Ø·Ø§Ø±</option>
                    <option value="Fitting">ØªØ±ÙƒÙŠØ¨ ÙÙ‚Ø· (Installation Only)</option>
                </select>
            </div>
            
            <div class="detail-row">
                <strong data-i18n="lens_price">Ø³Ø¹Ø± Ø§Ù„Ø¹Ø¯Ø³Ø©:</strong>
                <input type="number" id="lens-price" class="price-input" placeholder="0" oninput="calculateTotal()">
            </div>
            
            <div class="detail-row">
                <strong data-i18n="install_price">Ø³Ø¹Ø± Ø§Ù„ØªØ±ÙƒÙŠØ¨:</strong>
                <input type="number" id="install-price" class="price-input" placeholder="0" oninput="calculateTotal()">
            </div>

            <div class="detail-row total-row">
                <strong data-i18n="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong>
                <input type="text" id="total-price" class="price-input" value="0" readonly>
            </div>
        </div>

        <div class="footer">
            <div class="info-row">
                <strong data-i18n="employee">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù:</strong>
                <select id="emp-select" class="employee-select"></select>
            </div>
            <div class="signature-line">
                <strong data-i18n="signature">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹:</strong>
                <span>.........................</span>
            </div>
            <p style="margin-top: 15px;" data-i18n="thanks">Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ…</p>
        </div>
    </div>

    <div class="controls">
        <button class="btn print-current-btn" onclick="printAndSave()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© ÙˆØ­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
        <div style="display: flex; gap: 5px;">
            <button class="btn print-daily-btn" onclick="printDailyReport()" data-i18n="print_all_btn">ğŸ“‘ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ (<span id="count">0</span>)</button>
            <button class="btn lang-btn" onclick="toggleLanguage()">EN/AR</button>
        </div>
        <button class="btn clear-btn" onclick="clearArchive()" data-i18n="clear_btn">âš ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ (ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯)</button>
    </div>

    <div class="summary-section">
        <h4 style="text-align: center;">Ø³Ø¬Ù„ Ø§Ù„ÙŠÙˆÙ… (Daily Log)</h4>
        <table class="summary-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                    <th>Ø§Ù„ÙˆÙ‚Øª</th>
                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                    <th>Ø­Ø°Ù</th>
                </tr>
            </thead>
            <tbody id="summary-body"></tbody>
        </table>
    </div>

    <div id="hidden-print-area"></div>
</div>

<script>
    const employeesData = {
        "Noor 1": ["Ø¹Ù…Ø±", "Ø³ÙŠØ¯", "Ù…Ù‡Ø¯ÙŠ", "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ"],
        "Noor 2": ["Ø²Ø¨ÙŠØ±", "ÙÙˆØ§Ø² Ø²Ù‡Ø±Ø§Ù†ÙŠ"], 
        "Noor 3": ["Ø²Ø¨ÙŠØ±", "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ"],
        "Noor 4": ["Ø³Ù‡ÙŠÙ„"]
    };

    let archiveCount = 0;
    const translations = {
        ar: {
            dir: "rtl",
            print_all_btn: "ğŸ“‘ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ",
            clear_btn: "âš ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ (ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯)",
            invoice_title: "ÙØ§ØªÙˆØ±Ø© Ø·Ù„Ø¨ Ø¹Ø¯Ø³Ø§Øª",
            invoice_num: "Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:",
            branch: "Ø§Ù„ÙØ±Ø¹:",
            date: "Ø§Ù„ØªØ§Ø±ÙŠØ®:",
            time: "Ø§Ù„ÙˆÙ‚Øª:",
            eye_header: "Ø§Ù„Ø¹ÙŠÙ†",
            right_eye: "R (ÙŠÙ…ÙŠÙ†)",
            left_eye: "L (ÙŠØ³Ø§Ø±)",
            lens_type: "Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø¯Ø³Ø©:",
            lens_price: "Ø³Ø¹Ø± Ø§Ù„Ø¹Ø¯Ø³Ø©:",
            install_price: "Ø³Ø¹Ø± Ø§Ù„ØªØ±ÙƒÙŠØ¨:",
            total: "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:",
            employee: "Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù:",
            signature: "Ø§Ù„ØªÙˆÙ‚ÙŠØ¹:",
            thanks: "Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ…"
        },
        en: {
            dir: "ltr",
            print_all_btn: "ğŸ“‘ Print Daily Report",
            clear_btn: "âš ï¸ Clear Log (New Day)",
            invoice_title: "Lens Order Invoice",
            invoice_num: "Invoice No:",
            branch: "Branch:",
            date: "Date:",
            time: "Time:",
            eye_header: "Eye",
            right_eye: "R (Right)",
            left_eye: "L (Left)",
            lens_type: "Lens Type:",
            lens_price: "Lens Price:",
            install_price: "Install Price:",
            total: "Total:",
            employee: "Employee:",
            signature: "Signature:",
            thanks: "Thank You for Visiting"
        }
    };
    let currentLang = 'ar';

    function updateEmployees() {
        const branchSelect = document.getElementById('branch-select');
        const empSelect = document.getElementById('emp-select');
        const names = employeesData[branchSelect.value] || [];
        empSelect.innerHTML = "";
        names.forEach(name => {
            const opt = document.createElement('option');
            opt.value = name; opt.text = name; empSelect.appendChild(opt);
        });
    }

    function calculateTotal() {
        const lp = parseFloat(document.getElementById('lens-price').value) || 0;
        const ip = parseFloat(document.getElementById('install-price').value) || 0;
        document.getElementById('total-price').value = lp + ip;
    }

    function printAndSave() {
        saveTicketToArchive();
        window.print();
        setTimeout(clearCurrentForm, 1000);
    }

    function saveTicketToArchive() {
        const area = document.getElementById('current-ticket-area');
        const hidden = document.getElementById('hidden-print-area');
        const summary = document.getElementById('summary-body');
        const invNum = document.getElementById('inv-num').value || "-";
        const total = document.getElementById('total-price').value;
        const time = new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute:'2-digit' });
        const id = Date.now();

        const clone = area.cloneNode(true);
        clone.removeAttribute('id');
        clone.classList.add('saved-ticket');
        clone.setAttribute('data-id', id);

        clone.querySelectorAll('input, select').forEach(el => {
            const span = document.createElement('span');
            span.style.fontWeight = "bold";
            span.innerText = el.tagName === 'SELECT' ? el.options[el.selectedIndex].text : el.value;
            el.parentNode.replaceChild(span, el);
        });

        hidden.appendChild(clone);
        summary.innerHTML += `
            <tr data-id="${id}">
                <td>${archiveCount + 1}</td>
                <td>${invNum}</td>
                <td>${time}</td>
                <td>${total}</td>
                <td><button class="delete-btn" onclick="deleteInvoice(${id})">X</button></td>
            </tr>`;
        
        archiveCount++;
        document.getElementById('count').innerText = archiveCount;
    }

    function deleteInvoice(id) {
        if(!confirm("Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŸ")) return;
        const row = document.querySelector(`tr[data-id="${id}"]`);
        if(row) row.remove();
        const ticket = document.querySelector(`.saved-ticket[data-id="${id}"]`);
        if(ticket) ticket.remove();
        archiveCount--;
        document.getElementById('count').innerText = archiveCount;
    }

    function clearCurrentForm() {
        document.getElementById('lens-price').value = "";
        document.getElementById('install-price').value = "";
        document.getElementById('total-price').value = "0";
        document.getElementById('inv-num').value = "";
        document.querySelectorAll('.diopter-select').forEach(s => s.selectedIndex = 24);
    }

    function printDailyReport() {
        if (archiveCount === 0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ø§Ù„ÙŠÙˆÙ…!");
        document.body.classList.add('printing-report');
        window.print();
        document.body.classList.remove('printing-report');
    }

    function clearArchive() {
        if(confirm("Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ØŸ")) {
            document.getElementById('hidden-print-area').innerHTML = "";
            document.getElementById('summary-body').innerHTML = "";
            archiveCount = 0;
            document.getElementById('count').innerText = "0";
        }
    }

    function toggleLanguage() {
        currentLang = currentLang === 'ar' ? 'en' : 'ar';
        const t = translations[currentLang];
        document.documentElement.setAttribute('dir', t.dir);
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (key === 'print_all_btn') {
                el.innerHTML = `${t[key]} (<span id="count">${archiveCount}</span>)`;
            } else {
                el.innerText = t[key];
            }
        });
        updateEmployees();
    }

    function initDiopters() {
        let opts = "";
        for (let i = 6; i >= -6; i -= 0.25) {
            let v = (i > 0 ? "+" : "") + i.toFixed(2);
            opts += `<option value="${v}" ${i===0?'selected':''}>${v}</option>`;
        }
        document.querySelectorAll('.diopter-select').forEach(s => s.innerHTML = opts);
    }

    setInterval(() => {
        const now = new Date();
        document.getElementById('current-date').innerText = now.toLocaleDateString('en-GB');
        document.getElementById('current-time').innerText = now.toLocaleTimeString('en-US', { hour12: true });
    }, 1000);

    window.onload = () => { initDiopters(); updateEmployees(); };
</script>
</body>
</html>
