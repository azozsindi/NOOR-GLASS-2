<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ù†ÙˆØ± Ù„Ù„Ù†Ø¸Ø§Ø±Ø§Øª | NOOR Opticals</title>
    <style>
        /* Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
        body { font-family: 'Tahoma', 'Arial', sans-serif; margin: 0; padding: 0; background-color: #f5f5f5; color: #333; }
        .main-container { width: 80mm; margin: 20px auto; background: #fff; padding: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); min-height: 100vh; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ù„ÙˆØ¬Ùˆ */
        .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 10px; }
        .logo-img { max-width: 140px; height: auto; margin-bottom: 5px; }
        .logo-text { font-size: 22px; font-weight: bold; display: block; letter-spacing: 1px; }
        .sub-logo { font-size: 14px; font-weight: bold; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
        .ticket { border: 1px solid #ddd; padding: 10px; background: #fff; }
        .info-section { font-size: 12px; border-bottom: 1px dashed #000; padding-bottom: 8px; margin-bottom: 10px; }
        .info-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
        
        /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
        table { width: 100%; border-collapse: collapse; margin: 10px 0; font-size: 12px; }
        th, td { border: 1px solid #000; padding: 6px; text-align: center; }
        th { background-color: #f2f2f2; font-weight: bold; }
        
        /* Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª */
        select, input { font-family: inherit; font-size: 12px; border: 1px solid #ccc; padding: 3px; border-radius: 3px; font-weight: bold; }
        .price-input { width: 70px; text-align: center; }
        .total-row { border-top: 2px solid #000; padding-top: 8px; margin-top: 8px; font-weight: 900; font-size: 14px; }

        /* Ø§Ù„ØªØ°ÙŠÙŠÙ„ ÙˆØ§Ù„ØªÙˆÙ‚ÙŠØ¹ */
        .footer { margin-top: 15px; border-top: 1px dashed #000; padding-top: 10px; }
        .signature-area { margin-top: 35px; border-bottom: 1px solid #000; width: 100%; height: 25px; position: relative; }
        .sig-label { position: absolute; top: -20px; font-weight: bold; font-size: 12px; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„ØªØ­ÙƒÙ… */
        .controls { display: flex; flex-direction: column; gap: 8px; margin-top: 15px; padding: 10px; background: #eee; border-radius: 5px; }
        .btn { padding: 12px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 14px; transition: 0.3s; }
        .print-current-btn { background-color: #007bff; color: white; }
        .print-daily-btn { background-color: #28a745; color: white; }
        .lang-btn { background-color: #6c757d; color: white; }
        .clear-btn { background-color: #dc3545; color: white; font-size: 11px; padding: 8px; }

        /* Ø³Ø¬Ù„ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø³ÙÙ„ÙŠ */
        .summary-section { margin-top: 20px; border-top: 2px solid #333; }
        .summary-table { width: 100%; font-size: 11px; }
        .summary-table th { background: #333; color: #fff; }

        /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        #hidden-print-area { display: none; }
        @media print {
            @page { size: 80mm auto; margin: 0; }
            body { background: white; }
            .main-container { width: 100%; box-shadow: none; padding: 5px; margin: 0; }
            .controls, .summary-section, .delete-btn { display: none !important; }
            select, input { border: none !important; appearance: none; -webkit-appearance: none; background: transparent; padding: 0; }
            .ticket { border: none; }
            .signature-area { margin-top: 45px; }
        }
    </style>
</head>
<body>

<div class="main-container">
    <div id="current-ticket-area" class="ticket">
        <div class="header">
            <img src="logo.png" alt="Logo" class="logo-img" onerror="this.style.display='none'">
            <span class="logo-text">NOOR Opticals</span>
            <span class="sub-logo" data-i18n="sub_logo">Ù†Ù€Ù€Ù€ÙˆØ± Ù„Ù„Ù†Ø¸Ø§Ø±Ø§Øª</span>
            <h3 data-i18n="invoice_title" style="margin-top:10px;">ÙØ§ØªÙˆØ±Ø© Ø·Ù„Ø¨ Ø¹Ø¯Ø³Ø§Øª</h3>
        </div>

        <div class="info-section">
            <div class="info-row">
                <label data-i18n="invoice_num">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</label>
                <input type="text" id="inv-num" placeholder="...">
            </div>
            <div class="info-row">
                <label data-i18n="branch">Ø§Ù„ÙØ±Ø¹:</label>
                <select id="branch-select" onchange="updateEmployees()"></select>
            </div>
            <div class="info-row">
                <span><span data-i18n="date">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span> <span id="current-date"></span></span>
                <span><span data-i18n="time">Ø§Ù„ÙˆÙ‚Øª:</span> <span id="current-time"></span></span>
            </div>
        </div>

        <table>
            <thead>
                <tr><th data-i18n="eye_header">Ø§Ù„Ø¹ÙŠÙ†</th><th>SPH</th><th>CYL</th></tr>
            </thead>
            <tbody>
                <tr><td data-i18n="right_eye">R (ÙŠÙ…ÙŠÙ†)</td><td><select class="diopter-select"></select></td><td><select class="diopter-select"></select></td></tr>
                <tr><td data-i18n="left_eye">L (ÙŠØ³Ø§Ø±)</td><td><select class="diopter-select"></select></td><td><select class="diopter-select"></select></td></tr>
            </tbody>
        </table>

        <div class="details-section">
            <div class="info-row">
                <strong data-i18n="lens_type">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø¯Ø³Ø©:</strong>
                <select id="lens-type" style="width: 180px;"></select>
            </div>
            <div class="info-row">
                <strong data-i18n="lens_price">Ø³Ø¹Ø± Ø§Ù„Ø¹Ø¯Ø³Ø©:</strong>
                <input type="number" id="lens-price" class="price-input" oninput="calculateTotal()">
            </div>
            <div class="info-row">
                <strong data-i18n="install_price">Ø³Ø¹Ø± Ø§Ù„ØªØ±ÙƒÙŠØ¨:</strong>
                <input type="number" id="install-price" class="price-input" oninput="calculateTotal()">
            </div>
            <div class="info-row total-row">
                <strong data-i18n="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong>
                <input type="text" id="total-price" class="price-input" readonly>
            </div>
        </div>

        <div class="footer">
            <div class="info-row">
                <strong data-i18n="employee">Ø§Ù„Ù…ÙˆØ¸Ù:</strong>
                <select id="emp-select"></select>
            </div>
            <div class="signature-area">
                <span class="sig-label" data-i18n="signature">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹:</span>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="btn print-current-btn" onclick="printAndSave()" data-i18n="btn_print">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© ÙˆØ­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
        <div style="display: flex; gap: 5px;">
            <button class="btn print-daily-btn" style="flex:2" onclick="printDailyReport()" data-i18n="btn_report">ğŸ“‘ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</button>
            <button class="btn lang-btn" style="flex:1" onclick="toggleLanguage()">EN/AR</button>
        </div>
        <button class="btn clear-btn" onclick="clearArchive()" data-i18n="btn_clear">âš ï¸ Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„ÙŠÙˆÙ…</button>
    </div>

    <div class="summary-section">
        <h4 style="text-align: center; margin: 10px 0;" data-i18n="daily_log">Ø³Ø¬Ù„ Ø§Ù„ÙŠÙˆÙ…</h4>
        <table class="summary-table">
            <thead>
                <tr>
                    <th data-i18n="t_id">#</th>
                    <th data-i18n="t_inv">Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                    <th data-i18n="t_price">Ø§Ù„Ø³Ø¹Ø±</th>
                    <th data-i18n="t_del">Ø­Ø°Ù</th>
                </tr>
            </thead>
            <tbody id="summary-body"></tbody>
        </table>
    </div>
</div>

<div id="hidden-print-area"></div>

<script>
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„ÙØ±ÙˆØ¹
    const employeesData = {
        "ar": { "Noor 1": ["Ø¹Ù…Ø±", "Ø³ÙŠØ¯", "Ù…Ù‡Ø¯ÙŠ", "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡"], "Noor 2": ["Ø²Ø¨ÙŠØ±", "ÙÙˆØ§Ø²"], "Noor 3": ["Ø²Ø¨ÙŠØ±", "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡"], "Noor 4": ["Ø³Ù‡ÙŠÙ„"] },
        "en": { "Noor 1": ["Omar", "Said", "Mahdi", "Abdullah"], "Noor 2": ["Zubair", "Fawaz"], "Noor 3": ["Zubair", "Abdullah"], "Noor 4": ["Suhail"] }
    };

    // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø¯Ø³Ø§Øª ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    const lensOptions = {
        "ar": [
            "Ù…Ù„ØªÙŠ ÙƒÙˆØª (MC)", "Ø¨Ù„Ùˆ ÙƒØ§Øª (BL CUT)", "Ø¨Ù„Ùˆ ÙƒØ§Øª Ø¨Ù„Ùˆ (BL CUT BLUE)", "Ù‚Ø±ÙŠÙ† (GREEN)", 
            "Ù‚Ø±ÙŠÙ† Ø¨Ù„Ùˆ (GREEN BLUE)", "ÙÙˆØªÙˆ Ù‚Ø±ÙŠ (PGX)", "ÙÙˆØªÙˆ Ø¨Ø±Ø§ÙˆÙ† (PGX BROWN)", 
            "Ù‚Ø±ÙŠØ¨ / Ø¨Ø¹ÙŠØ¯ (PROGRESSIVE)", "Ø¶Ø¯ Ø§Ù„ÙƒØ³Ø± (POLY)", "Ù†ÙˆØ±Ù…Ù„ (CR39)", 
            "Ù…Ù„ØªÙŠ ÙƒÙˆØª 1.61 (MC 1.61)", "Ù…Ù„ØªÙŠ ÙƒÙˆØª 1.67 (MC 1.67)", "ØªØ±ÙƒÙŠØ¨ Ø¥Ø·Ø§Ø± ÙƒØ§Ù…Ù„", 
            "ØªØ±ÙƒÙŠØ¨ Ù†Øµ Ø¥Ø·Ø§Ø±", "ØªØ±ÙƒÙŠØ¨ Ø±ÙŠÙ…Ù„Ø³", "Ù†Ù‚Ù„ Ø¹Ø¯Ø³Ø§Øª Ø¥Ø·Ø§Ø± ÙƒØ§Ù…Ù„", "Ù†Ù‚Ù„ Ø¹Ø¯Ø³Ø§Øª Ù†Øµ Ø¥Ø·Ø§Ø±", 
            "Ù†Ù‚Ù„ Ø¹Ø¯Ø³Ø§Øª Ø±ÙŠÙ…Ù„Ø³", "ØªØ±ÙƒÙŠØ¨ Ø¥Ø·Ø§Ø± ÙƒØ§Ù…Ù„ Ù…Ø¹ ØªÙ„ÙˆÙŠÙ†", "ØªØ±ÙƒÙŠØ¨ Ù†Øµ Ø¥Ø·Ø§Ø± Ù…Ø¹ ØªÙ„ÙˆÙŠÙ†", "ØªØ±ÙƒÙŠØ¨ Ø±ÙŠÙ…Ù„Ø³ Ù…Ø¹ ØªÙ„ÙˆÙŠÙ†"
        ],
        "en": [
            "Multi-Coat (MC)", "BL CUT", "BL CUT BLUE", "GREEN", "GREEN BLUE", "Photo Grey (PGX)", 
            "Photo Brown (PGX BROWN)", "PROGRESSIVE", "POLY", "CR39", "MC 1.61", "MC 1.67", 
            "Full Frame Fitting", "Half Frame Fitting", "Rimless Fitting", "Transfer (Full Frame)", 
            "Transfer (Half Frame)", "Transfer (Rimless)", "Full Frame + Tint", "Half Frame + Tint", "Rimless + Tint"
        ]
    };

    const translations = {
        ar: { sub_logo: "Ù†Ù€Ù€Ù€ÙˆØ± Ù„Ù„Ù†Ø¸Ø§Ø±Ø§Øª", invoice_title: "ÙØ§ØªÙˆØ±Ø© Ø·Ù„Ø¨ Ø¹Ø¯Ø³Ø§Øª", invoice_num: "Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:", branch: "Ø§Ù„ÙØ±Ø¹:", date: "Ø§Ù„ØªØ§Ø±ÙŠØ®:", time: "Ø§Ù„ÙˆÙ‚Øª:", eye_header: "Ø§Ù„Ø¹ÙŠÙ†", right_eye: "R (ÙŠÙ…ÙŠÙ†)", left_eye: "L (ÙŠØ³Ø§Ø±)", lens_type: "Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø¯Ø³Ø©:", lens_price: "Ø³Ø¹Ø± Ø§Ù„Ø¹Ø¯Ø³Ø©:", install_price: "Ø³Ø¹Ø± Ø§Ù„ØªØ±ÙƒÙŠØ¨:", total: "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:", employee: "Ø§Ù„Ù…ÙˆØ¸Ù:", signature: "Ø§Ù„ØªÙˆÙ‚ÙŠØ¹:", btn_print: "ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© ÙˆØ­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©", btn_report: "ğŸ“‘ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ", btn_clear: "âš ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„", daily_log: "Ø³Ø¬Ù„ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…", t_id: "#", t_inv: "Ø§Ù„ÙØ§ØªÙˆØ±Ø©", t_price: "Ø§Ù„Ø³Ø¹Ø±", t_del: "Ø­Ø°Ù" },
        en: { sub_logo: "NOOR Opticals", invoice_title: "Lens Order Invoice", invoice_num: "Invoice No:", branch: "Branch:", date: "Date:", time: "Time:", eye_header: "Eye", right_eye: "R (Right)", left_eye: "L (Left)", lens_type: "Lens Type:", lens_price: "Lens Price:", install_price: "Fitting Fee:", total: "Total:", employee: "Staff:", signature: "Signature:", btn_print: "ğŸ–¨ï¸ Print & Save", btn_report: "ğŸ“‘ Daily Report", btn_clear: "âš ï¸ Clear Day", daily_log: "Daily Log", t_id: "#", t_inv: "Inv", t_price: "Price", t_del: "Del" }
    };

    let currentLang = 'ar';
    let archiveCount = 0;

    function toggleLanguage() {
        currentLang = currentLang === 'ar' ? 'en' : 'ar';
        const t = translations[currentLang];
        document.documentElement.setAttribute('dir', currentLang === 'ar' ? 'rtl' : 'ltr');
        
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            el.innerText = t[key];
        });
        updateDropdowns();
    }

    function updateDropdowns() {
        const branchSelect = document.getElementById('branch-select');
        branchSelect.innerHTML = ["Noor 1", "Noor 2", "Noor 3", "Noor 4"].map(b => `<option value="${b}">${b}</option>`).join('');
        
        const lensSelect = document.getElementById('lens-type');
        lensSelect.innerHTML = lensOptions[currentLang].map(l => `<option value="${l}">${l}</option>`).join('');
        updateEmployees();
    }

    function updateEmployees() {
        const branch = document.getElementById('branch-select').value;
        const empSelect = document.getElementById('emp-select');
        const names = employeesData[currentLang][branch] || [];
        empSelect.innerHTML = names.map(n => `<option value="${n}">${n}</option>`).join('');
    }

    function calculateTotal() {
        const lp = parseFloat(document.getElementById('lens-price').value) || 0;
        const ip = parseFloat(document.getElementById('install-price').value) || 0;
        document.getElementById('total-price').value = (lp + ip).toFixed(2);
    }

    function printAndSave() {
        saveToArchive();
        window.print();
        setTimeout(() => {
            document.getElementById('lens-price').value = "";
            document.getElementById('install-price').value = "";
            document.getElementById('total-price').value = "";
            document.getElementById('inv-num').value = "";
        }, 1000);
    }

    function saveToArchive() {
        const id = Date.now();
        const area = document.getElementById('current-ticket-area');
        const clone = area.cloneNode(true);
        clone.classList.add('saved-ticket');
        clone.setAttribute('data-id', id);

        clone.querySelectorAll('input, select').forEach(el => {
            const span = document.createElement('span');
            span.style.fontWeight = "bold";
            span.innerText = el.tagName === 'SELECT' ? el.options[el.selectedIndex].text : el.value;
            el.parentNode.replaceChild(span, el);
        });

        document.getElementById('hidden-print-area').appendChild(clone);
        
        const summary = document.getElementById('summary-body');
        const row = document.createElement('tr');
        row.setAttribute('data-id', id);
        row.innerHTML = `
            <td>${++archiveCount}</td>
            <td>${document.getElementById('inv-num').value || '-'}</td>
            <td>${document.getElementById('total-price').value || '0'}</td>
            <td><button class="delete-btn" style="color:red; border:none; background:none; cursor:pointer;" onclick="deleteRecord(${id})">âœ–</button></td>
        `;
        summary.appendChild(row);
    }

    function deleteRecord(id) {
        if(!confirm("Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŸ")) return;
        document.querySelector(`tr[data-id="${id}"]`).remove();
        document.querySelector(`.saved-ticket[data-id="${id}"]`).remove();
    }

    function printDailyReport() {
        if(archiveCount === 0) return alert("Ø§Ù„Ø³Ø¬Ù„ ÙØ§Ø±Øº!");
        window.print();
    }

    function clearArchive() {
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…ØŸ")) location.reload();
    }

    window.onload = () => {
        let opts = "";
        for (let i = 6; i >= -6; i -= 0.25) {
            let v = (i > 0 ? "+" : "") + i.toFixed(2);
            opts += `<option value="${v}" ${i===0?'selected':''}>${v}</option>`;
        }
        document.querySelectorAll('.diopter-select').forEach(s => s.innerHTML = opts);
        
        updateDropdowns();
        
        setInterval(() => {
            const now = new Date();
            document.getElementById('current-date').innerText = now.toLocaleDateString('ar-EG');
            document.getElementById('current-time').innerText = now.toLocaleTimeString('ar-EG', {hour: '2-digit', minute:'2-digit'});
        }, 1000);
    };
</script>

</body>
</html>
